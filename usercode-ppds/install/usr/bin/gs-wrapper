#!/bin/sh
LOG_FILE="/tmp/gs-wrapper.log"
date -R >> "$LOG_FILE"

# All in $LOG_FILE
echo "$0 $@" >> "$LOG_FILE"
set >> "$LOG_FILE"

#USER_IS_UNDER_MY_CONTROL="$(ps -ax | grep "^[[:blank:]]*$PPID[[:blank:]]")"

#echo "Te tengo ladron $USER_IS_UNDER_MY_CONTROL">> "$LOG_FILE"
ASKUSER="$(ps -p "$PPID" -o  cmd= |cut -d " " -f 3)"
echo $ASKUSER >> "$LOG_FILE"

USERCODE="$(aurex-notify -u "$ASKUSER" ASK "--regexp=[0-9][0-9][0-9][0-9]" "Codigo de Profesor (cuatro digitos)")"
PPDFILE="$(basename "$PPD")"
echo "$USERCODE" >> "$LOG_FILE"
echo "$PPDFILE" >> "$LOG_FILE"

sudo usercode-ppd set "$PPDFILE" "$USERCODE"

echo "==========================" >> "$LOG_FILE"
echo "===    END OF LOG   ======" >> "$LOG_FILE"
echo "==========================" >> "$LOG_FILE"

# The last call
exec gs "$@"
exit 0
